{% extends "base.html" %} {% block title %}ãƒã‚¤ãƒšãƒ¼ã‚¸ - UniChat{% endblock %} {%
block content %}
<div class="timeline-container">
  <h2>{{ current_user.username }} ã®ãƒã‚¤ãƒšãƒ¼ã‚¸</h2>
  <div class="mb-3">
    <a href="{{ url_for('post') }}" class="btn btn-tweet">æ–°è¦æŠ•ç¨¿</a>
  </div>

  {% if posts %} {% for post in posts %}
  <div class="post-card">
    <div class="post-header">
      <span class="username">{{ post.author.username }}</span>
      <span class="timestamp">{{ post.timestamp|jst }}</span>
      <span class="channel-label {{ post.channel }}" data-channel="{{ post.channel }}">
        {{ post.channel|channel_jp }}
      </span>
      <div class="post-actions">
        <button class="btn-delete" onclick="deletePost({{ post.id }})" title="å‰Šé™¤">
          <i class="delete-icon">ğŸ—‘ï¸</i>
        </button>
      </div>
    </div>
    <div class="post-content">{{ post.content }}</div>
  </div>
  {% endfor %} {% else %}
  <div class="alert alert-info">
    æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®æŠ•ç¨¿ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
  </div>
  {% endif %}
</div>
{% endblock %} {% block scripts %}
<script>
  // ãƒãƒ£ãƒ³ãƒãƒ«åã‹ã‚‰è‰²ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
  function getChannelColor(channelName) {
    let hash = 0;
    for (let i = 0; i < channelName.length; i++) {
      const char = channelName.charCodeAt(i);
      hash = (hash << 5) - hash + char;
      hash = hash & hash;
    }

    const hue = Math.abs(hash) % 360;
    const saturation = 65 + (Math.abs(hash) % 20);
    const lightness = 45 + (Math.abs(hash) % 15);

    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
  }

  // ãƒãƒ£ãƒ³ãƒãƒ«ãƒ©ãƒ™ãƒ«ã«å‹•çš„è‰²ã‚’é©ç”¨
  document.addEventListener("DOMContentLoaded", function () {
    const channelLabels = document.querySelectorAll(".channel-label");

    channelLabels.forEach((label) => {
      const channelName = label.dataset.channel;
      
      if (channelName && !["general", "job", "class", "circle"].includes(channelName)) {
        const color = getChannelColor(channelName);
        label.style.backgroundColor = color;
      }
    });
  });

  // æŠ•ç¨¿å‰Šé™¤æ©Ÿèƒ½
  function deletePost(postId) {
    if (confirm('ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = `/delete_post/${postId}`;
      
      document.body.appendChild(form);
      form.submit();
    }
  }
</script>
{% endblock %}
</script>
{% endblock %}
